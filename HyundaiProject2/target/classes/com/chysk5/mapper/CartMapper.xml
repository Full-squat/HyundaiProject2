<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chysk5.mapper.CartMapper">

<!-- 카트 조회 -->
<select id="cartList" resultType="com.chysk5.domain.CartDTO">
<![CDATA[
select c.*,p.pro_name,p.pro_price,po.pro_opt_size,po.pro_opt_stock,pi.pro_loc
from cart c, product p, product_option po,(
select pro_loc, product_pro_id from(
select pro_loc, product_pro_id,row_number()over(partition by product_pro_id order by pro_Loc) as rownumber
from pro_image)
where rownumber<=1
order by product_pro_id
) pi
where p.pro_id= pi.product_pro_id
  and p.pro_id =c.product_option_pro_opt_id
  and p.pro_id =po.pro_opt_id
  and c.member_mem_id =#{mem_id}
]]>
</select>

<!-- 카트 담기 -->
<insert id="addCart">
insert into cart(cart_no,cart_regdate,cart_select,member_mem_id,product_option_pro_opt_id,cart_amount)
values(cart_seq.nextval,SYSDATE,1,#{member_mem_id},#{product_option_pro_opt_id},1)
</insert>

<!--option id 조회 -->
<select id="searchOptid" parameterType="String" resultType="java.lang.String" >

select a.pro_opt_id
from product_option a,product b
where a.product_pro_id= #{product_pro_id}
 and a.pro_opt_size= #{pro_opt_size}
 and b.pro_name= #{pro_name}
 
</select>
</mapper>