<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chysk5.mapper.ResellMapper">

	<select id="getMyResellProduct"
		resultType="com.chysk5.domain.ResellProductDTO">
		SELECT pro_name, pro_opt_size, pro_price
		FROM product p
		INNER
		JOIN product_option po
		ON p.pro_id = po.product_pro_id
		WHERE pro_opt_id
		= #{pro_opt_id}
	</select>

	<select id="getPriceList" resultType="com.chysk5.domain.ResellPriceDTO">
	<![CDATA[
		SELECT resell.pro_opt_size, resell.re_price
		FROM
		(SELECT p.pro_opt_size, r.re_price
		FROM r_product r
		INNER JOIN product_option p
		ON r.product_option_pro_opt_id = p.pro_opt_id
		WHERE r.product_option_pro_opt_id = #{pro_opt_id}
		ORDER BY r.re_price ASC) resell
		WHERE ROWNUM <= 5
		]]>
	</select>

	<insert id="register">
		INSERT INTO r_product (re_id, re_price, re_regdate, re_update, re_available,
		member_mem_id, product_option_pro_opt_id)
		VALUES (#{re_id},
		#{re_price}, sysdate, sysdate, #{re_available}, #{member_mem_id},
		#{product_option_pro_opt_id})
	</insert>
	
	<select id="getMyRank" resultType="int">
	<![CDATA[
		SELECT R.RANK
		FROM(
		SELECT re_id, RANK() OVER (ORDER BY re_price ASC) AS RANK
		FROM r_product
		WHERE r_product.product_option_pro_opt_id = #{pro_opt_id}
		AND re_price < #{re_price}
		ORDER BY RANK DESC) R
		WHERE ROWNUM = 1
		]]>
	</select>

</mapper>
  